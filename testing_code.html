
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing code &#8212; Quality Assurance of Code for Analysis and Research</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/logo.css" />
    <link rel="stylesheet" type="text/css" href="_static/admonitions.css" />
    <link rel="stylesheet" type="text/css" href="_static/accessibility.css" />
    <link rel="stylesheet" type="text/css" href="_static/markdown_within_tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Learning Resources" href="learning.html" />
    <link rel="prev" title="Peer review" href="peer_review.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/duck_book_logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Quality Assurance of Code for Analysis and Research</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="checklists.html">
   Code quality assurance checklists
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="checklist_lower.html">
     Lower quality assurance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="checklist_moderate.html">
     Moderate quality assurance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="checklist_higher.html">
     Higher quality assurance
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Guidance
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="principles.html">
   Principles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="core_programming.html">
   Core programming practices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project_structure.html">
   Structuring your project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code_documentation.html">
   Code documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project_documentation.html">
   Project documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="version_control.html">
   Version control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configuration.html">
   Configuration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data.html">
   Data Management
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="peer_review.html">
   Peer review
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Testing code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="learning.html">
   Learning Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tools.html">
   Tools
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <p>Book version 2021.7</p><a href='https://www.gov.uk/government/organisations/government-analysis-function' target='_blank'><img src='./_static/af_logo.png' alt='The Government Analysis Function logo' style='width:50%;'></a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/testing_code.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/best-practice-and-impact/qa-of-code-guidance"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/best-practice-and-impact/qa-of-code-guidance/issues/new?title=Issue%20on%20page%20%2Ftesting_code.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/best-practice-and-impact/qa-of-code-guidance/edit/master/testing_code.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-test-code">
   Why test code?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-to-test">
   What to test
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#when-to-run-tests">
   When to run tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#layers-of-testing">
   Layers of testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#structuring-test-code">
   Structuring test code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#unit-testing">
   Unit testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integration-testing">
   Integration testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#end-to-end-testing">
   End-to-end testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reducing-repetition-in-tests">
   Reducing repetition in tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fixtures">
     Fixtures
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameterization">
     Parameterization
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="testing-code">
<h1>Testing code<a class="headerlink" href="#testing-code" title="Permalink to this headline">¶</a></h1>
<p>Testing refers here to code that verifies that your code is working as expected.
Where code documentation specifies what code should do, testing assures that this specification is true.</p>
<p>The core concept of testing is <strong>“Does my code do what I expect it to, given realistic inputs?”</strong>.</p>
<p>The most common pattern for writing these tests is:</p>
<ol class="simple">
<li><p>Arrange - set up any pre-requisites for your test</p></li>
<li><p>Act - run the code that you are testing</p></li>
<li><p>Assert - verify that the code performed the expected action</p></li>
</ol>
<div class="section" id="why-test-code">
<h2>Why test code?<a class="headerlink" href="#why-test-code" title="Permalink to this headline">¶</a></h2>
<p>You can’t be sure that your code works without having run it with realistic examples. Tests can verify that users expectations are met by the code.
They let you know when you’ve broken the expected functionality of your code - or when users have.
They can be used to report or flag poor performance (e.g. modelling).
Well-structured code is easier to write tests for, so testing incentivises good code structure.</p>
<p>Testing is crucial to assuring quality in your code and will also increase efficiency in the development of your code.</p>
</div>
<div class="section" id="what-to-test">
<h2>What to test<a class="headerlink" href="#what-to-test" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>A quality assurance engineer walks into a bar. They order 1 beer. They order 3.14 beers. They order -1 beers. They order 99999999999 beers. They order a lizard. They order <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
</div></blockquote>
<blockquote>
<div><p>The first customer walks in and asks where the bathroom is. The bar bursts into flames.</p>
</div></blockquote>
<p>Unfortunately, there’s no golden rule for exactly what you should test.
We can use general guides to direct where most of our testing effort goes.</p>
<p>You should:</p>
<ul class="simple">
<li><p>Focus on testing the most complex and vulnerable parts of your code</p></li>
<li><p>Write a new test every time you find a bug, to squash it for good</p></li>
<li><p>Focus on testing the most realistic use cases of your code</p></li>
<li><p>Test external interfaces - what happens if something unexpected is returned from one of your dependencies?</p></li>
<li><p>Document what your code should and shouldn’t be used for, to steer users towards the correct and tested usage</p></li>
</ul>
<p>You shouldn’t:</p>
<ul class="simple">
<li><p>Attempt to test every possible input and type of input</p></li>
<li><p>Focus on things that are already sufficiently tested (e.g. it should not be necessary to test the functionality from your dependencies packages if you are confident that they are already been subjected to sufficient assurance)</p></li>
<li><p>Write tests that have an element of randomness - tests should be deterministic</p></li>
</ul>
<p>A short check-list for questions to ask when writing tests:</p>
<ul class="simple">
<li><p>Have I tested realistic combinations of my code’s input parameters?</p></li>
<li><p>Have I tested any discrete outputs once?</p></li>
<li><p>Have I tested the boundaries of non-discrete outputs?</p></li>
<li><p>Are informative errors raised when the code is not used in a valid or correct way?</p></li>
<li><p>Are informative warnings raised when the code is not used in a standard way?</p></li>
</ul>
<p>Don’t worry if writing all of these tests sounds like a large task.
You’ll find that tests are very repetitive in nature, so we can reuse testing code to broaden the cases that our tests cover.
We’ll describe two useful ways of reducing the burden of writing and maintaining tests in a later section.</p>
<p>The examples in this section use these testing frameworks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> for Python</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">testthat</span></code> for R</p></li>
</ul>
<p>R users might also be interested in <code class="docutils literal notranslate"><span class="pre">assertthat</span></code>, which provides Python-like assertions in R.</p>
<p>Other common frameworks, which have a Class-based focus, are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unittest</span></code> built into Python</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Runit</span></code> for R</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Modelling-relevant testing
including <a class="reference external" href="https://www.jeremyjordan.me/testing-ml/">https://www.jeremyjordan.me/testing-ml/</a></p>
<p><a class="reference external" href="https://github.com/best-practice-and-impact/qa-of-code-guidance/issues/15">#15</a></p>
</div>
</div>
<div class="section" id="when-to-run-tests">
<h2>When to run tests<a class="headerlink" href="#when-to-run-tests" title="Permalink to this headline">¶</a></h2>
<p>Tests should be run whenever you make changes to your project.
This ensures that changes do not break the existing, intended functionality of your code.
When tests fail, you should endeavour to fix these before adding these changes to a stable or production version of your code.</p>
<p>If you have intentionally altered the functionality of your code, this will likely break existing tests.
Failing tests here are a good reminder that your should update your documentation and tests to reflect the new functionality.</p>
<p>If your collection of tests runs quickly, it’s simplest to run them all often.
If some tests take considerably longer to run, you might want to run these less often - perhaps only when relevant changes have been made.
Otherwise, running the entire collection of tests has the added benefit of capturing unexpected side-effects of your changes.
For example, you might pick up an unexpected failure in part of your code that you have not directly changed.</p>
<p>It’s not easy to remember to run your tests at regular intervals.
You’re already putting effort into <code class="docutils literal notranslate"><span class="pre">commit</span></code>ing your changes to a version control system regularly.
And you’re right to think “surely this could be automated too?”
<a class="reference internal" href="version_control.html#continuous-integration"><span class="std std-ref">Continuous integration</span></a> can be used to automate testing, amongst other quality assurance measures, and can be triggered when changes are made to your remote version control repository.
These tools can be used to ensure that all changes to a particular project are tested.
Additionally, it allows others that are reviewing your code to see the results of your tests.</p>
<p>An alternative to continuous integration, is using a Git hook.
<a class="reference external" href="https://git-scm.com/docs/githooks">Git hooks</a> are scripts that can be set to run locally at specific points in your Git workflow.
For example, we might set up a <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> or <code class="docutils literal notranslate"><span class="pre">pre-push</span></code> hook that runs our tests before we make each commit or push to the remote repository.
This might stop our commit/push if the tests fail, so that we don’t push breaking changes to our remote repository.</p>
</div>
<div class="section" id="layers-of-testing">
<h2>Layers of testing<a class="headerlink" href="#layers-of-testing" title="Permalink to this headline">¶</a></h2>
<p>Testing comes in many shapes and sizes.</p>
<p>In its simplest form, a test asserts that an expectation is true:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">if </span><span class="p">(</span><span class="m">1</span> <span class="o">!=</span> <span class="m">1</span><span class="p">)</span><span class="o">:</span>
  <span class="nf">stop</span><span class="p">(</span><span class="s">&quot;Something has gone terribly wrong&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>In this chapter we will describe a more formalised method for testing.</p>
<p>In order of increasing scale, the main layers of testing covered here will be:</p>
<ul class="simple">
<li><p>Unit testing - assuring that functions or class methods perform as expected</p></li>
<li><p>Integration testing - assuring that multiple units interact with each other as expected</p></li>
<li><p>End-to-end or system testing - verifying that a complete system meets its requirements</p></li>
</ul>
<p>The time taken to develop and run individual tests roughly increases down this list.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Acceptance_testing">Acceptance testing</a> is often considered as an additional level, but is not covered here.</p>
<p>The following sections will climb through these layers of testing.
Please note that the principles covered early on also apply at subsequent levels.</p>
</div>
<div class="section" id="structuring-test-code">
<h2>Structuring test code<a class="headerlink" href="#structuring-test-code" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Need to write structure test code</p>
<p>Might just be a reference to project structure?</p>
<p>Lots of content needed below</p>
<p><a class="reference external" href="https://github.com/best-practice-and-impact/qa-of-code-guidance/issues/27">#27</a></p>
</div>
</div>
<div class="section" id="unit-testing">
<h2>Unit testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h2>
<div class="admonition-learning admonition">
<p class="admonition-title">Key Learning</p>
<p>You should follow the <a class="reference external" href="https://learninghub.ons.gov.uk/enrol/index.php?id=539">Introduction to Unit Testing course</a> (GSS only) for applied examples in Python and R.
The course also covers writing and documenting functions, and error handling.</p>
<p>Other resources include:</p>
<ul class="simple">
<li><p>Hadley Wickham’s <a class="reference external" href="https://vita.had.co.nz/papers/testthat.pdf">testthat: getting started with testing</a></p></li>
<li><p><a class="reference external" href="https://docs.pytest.org/en/3.0.1/getting-started.html"><code class="docutils literal notranslate"><span class="pre">pytest</span></code> getting started</a></p></li>
<li><p>Real Python <a class="reference external" href="https://realpython.com/python-testing/">Getting Started With Testing in Python</a></p></li>
</ul>
</div>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>These testing sections all need more content/examples.</p>
<p><a class="reference external" href="https://github.com/best-practice-and-impact/qa-of-code-guidance/issues/28">#28</a></p>
</div>
</div>
<div class="section" id="integration-testing">
<h2>Integration testing<a class="headerlink" href="#integration-testing" title="Permalink to this headline">¶</a></h2>
<p>Your analysis likely involves multiple units working together to perform a high level task.
Assuring that individual units work as expected, using unit testing, does not guarantee that multiple units interact with one another as expected.</p>
<div class="figure align-default" id="no-integration-tests">
<a class="reference internal image-reference" href="_images/no_integration_tests.png"><img alt="Two drawers that open into each other's handles." src="_images/no_integration_tests.png" style="width: 40%;" /></a>
<p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Two unit tests, no integration tests.</span><a class="headerlink" href="#no-integration-tests" title="Permalink to this image">¶</a></p>
</div>
<p>Integration tests incorporate two or more units and check that they work together correctly.
These tests are also used to test the interface between your code and external dependencies, such as a database or web-based API.</p>
<p>When your code relies upon interaction with complex or external dependencies, it may be difficult for your tests to reproducibly access these dependencies.
Creating abstractions of these dependencies when they are not being directly tested can keep your test code simpler and more focused.
You might use Stubs or Mocks for this purpose:</p>
<ul class="simple">
<li><p>Stubs carry out a predetermined behaviour. For example, a stub representing an API always returns the same response. Use these when you are not interested in the details around how your code interacts with the dependency.</p></li>
<li><p>Mocks require additional setup in your test code, to define your expectations. Use these when your test needs to verify that your code interacts with the Mock in a specific way.</p></li>
</ul>
</div>
<div class="section" id="end-to-end-testing">
<h2>End-to-end testing<a class="headerlink" href="#end-to-end-testing" title="Permalink to this headline">¶</a></h2>
<p>As the name suggests, these tests cover the entire process.
The motivation for using end-to-end tests is similar to that of integration tests.
Despite assurance that small sections of the code are functioning correctly, it’s important to validate that your overall system is fit for purpose.</p>
<div class="figure align-default" id="sinking-ship">
<a class="reference internal image-reference" href="https://i.stack.imgur.com/Nirxy.jpg"><img alt="A sinking ship would still report passing unit tests." src="https://i.stack.imgur.com/Nirxy.jpg" style="width: 50%;" /></a>
<p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">A sinking ship would still report a number of passing unit and integration tests, while the system is failing overall.</span><a class="headerlink" href="#sinking-ship" title="Permalink to this image">¶</a></p>
</div>
<p>These tests are much slower to run and can take longer to develop for complex processes.
Having at least one end-to-end test for your process will ensure that the high-level specification of your code is met.
This should validate that your user requirements are met.</p>
</div>
<div class="section" id="reducing-repetition-in-tests">
<h2>Reducing repetition in tests<a class="headerlink" href="#reducing-repetition-in-tests" title="Permalink to this headline">¶</a></h2>
<p>Repetitive test code violates the “Don’t repeat yourself” rule.
As with functional code, test code is much easier to maintain when it is modular and reusable.</p>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Add examples to reducing repetition in tests to demonstrate these</p>
<p><a class="reference external" href="https://github.com/best-practice-and-impact/qa-of-code-guidance/issues/29">#29</a></p>
</div>
<div class="section" id="fixtures">
<h3>Fixtures<a class="headerlink" href="#fixtures" title="Permalink to this headline">¶</a></h3>
<p>As your test suite grows, you might notice that many of your tests use similar code to prepare your tests or to clean up after each test has run.
Copying these code snippets for each test is laborious and also increases the risk of inconsistently applying those steps.</p>
<p>Fixtures help us to avoid this form of repetition in our tests.
You define your test preparation and clean up within a function (the fixture).
You then use the fixture to carry out these steps consistently for each test that they are required for.</p>
<p>In Class-based testing frameworks, these functions tend to be separated into <code class="docutils literal notranslate"><span class="pre">SetUp</span></code> and <code class="docutils literal notranslate"><span class="pre">TearDown</span></code> functions.
These are similarly set to run before and after each test, respectively.</p>
<p>Fixtures can be especially useful when setting up a test object takes a large amount of time or resource.
They can be designed to run for each test, once for a group of tests or once for the whole test suite.
They are also useful for undoing any consequences of each test run.
For example, removing data which has been written to a temporary file or database.</p>
<p>Reference material:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.pytest.org/en/stable/fixture.html">Python <code class="docutils literal notranslate"><span class="pre">pytest</span></code> Fixture</a> documentation</p></li>
<li><p><a class="reference external" href="https://testthat.r-lib.org/articles/test-fixtures.html">R <code class="docutils literal notranslate"><span class="pre">testthat</span></code> Fixture</a> documentation</p></li>
</ul>
</div>
<div class="section" id="parameterization">
<h3>Parameterization<a class="headerlink" href="#parameterization" title="Permalink to this headline">¶</a></h3>
<p>You might also find that similar steps are taken when testing multiple combinations of inputs and outputs.
Parameterization allows us to reduce repetition in our code, in a similar way to reusable functions.
We specify the pairs of inputs and expected outputs, so that our testing tool can repeat a test for each scenario.</p>
<p>Note that this approach is equivalent to using a for-loop to apply a test function over multiple inputs and expected outputs.
However, using functionality from test packages may improve running efficiency and the detail of subsequent test reports.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, this can be achieved using the <a class="reference external" href="https://docs.pytest.org/en/stable/parametrize.html">Parametrize mark</a>.</p>
<p>In R, the <code class="docutils literal notranslate"><span class="pre">patrick</span></code> package extends <code class="docutils literal notranslate"><span class="pre">testthat</span></code> to provide a <a class="reference external" href="https://rdrr.io/cran/patrick/man/with_parameters_test_that.html"><code class="docutils literal notranslate"><span class="pre">with_parameters_test_that</span></code></a> function to achieve this.</p>
<div class="admonition-todo admonition" id="id5">
<p class="admonition-title">Todo</p>
<p>Testing in multiple environments?</p>
<ul class="simple">
<li><p><a class="reference external" href="https://tox.readthedocs.io/en/latest/">tox</a>/<a class="reference external" href="https://nox.thea.codes/en/stable/">nox</a></p></li>
<li><p><a class="reference external" href="https://r-hub.github.io/rhub/">rhub</a></p></li>
</ul>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="peer_review.html" title="previous page">Peer review</a>
    <a class='right-next' id="next-link" href="learning.html" title="next page">Learning Resources</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          <div class="extra_footer">
            <p>Best Practice & Impact division, Office for National Statistics</p><p>This document is very young, please help use to make it grow by providing any feedback by <a href='mailto:gsshelp@statistics.gov.uk'>email</a> or via the <a href='https://github.com/best-practice-and-impact/qa-of-code-guidance'>GitHub repository</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>